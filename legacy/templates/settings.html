<!--
================================================================================
JOB APPLICATION TRACKER - SETTINGS MANAGEMENT TEMPLATE
================================================================================
This template provides comprehensive settings management for the job application
tracking system. It manages two main configuration types: application process
steps and feedback definitions that are used throughout the application.

Features:
- Step Definitions Management (Application process stages)
- Feedback Definitions Management (Application outcomes)
- Color-coded visual indicators for steps and feedback
- Protected system definitions (cannot edit/delete core items)
- Real-time form validation
- Modal-based CRUD operations
- Application count warnings before deletion

Data Dependencies:
- steps: List of all step definitions
- feedbacks: List of all feedback definitions
================================================================================
-->

{% extends "base.html" %}

{% block title %}Settings - Job Tracker{% endblock %}

{% block content %}
<div class="setting-box">
    
    <!-- 
    ========================================================================
    STEP DEFINITIONS MANAGEMENT SECTION
    ========================================================================
    This section manages the application process steps that define the
    stages of job applications (Applied, Interview, Offer, etc.).
    ========================================================================
    -->
    <div class="item-setting">
        <!-- Section Header -->
        <h3 class="box_title">Steps Settings</h3>
        
        <!-- 
        ====================================================================
        CREATE STEP DEFINITION FORM
        ====================================================================
        Form for adding new step definitions with validation.
        Includes hidden form type for backend processing.
        ====================================================================
        -->
        <div class="glass-container-settings">
            <form method="post" class="form_steps_definition">
                <!-- Hidden field to identify form type in backend -->
                <input type="hidden" name="form_type" value="create_step_defition">
                
                <!-- Step Name Input -->
                <input type="text" 
                       id="step_name" 
                       name="step_name" 
                       placeholder="Step Name" 
                       class="form-input-settings"
                       required>
                <br>
                
                <!-- Step Description Input -->
                <input type="text" 
                       id="step_description" 
                       name="step_description" 
                       placeholder="Step Description" 
                       class="form-input-settings"
                       required>
                <br>
                
                <!-- Step Color Picker -->
                <input type="color" 
                       id="step_color" 
                       name="step_color" 
                       class="form-color-settings" 
                       value="#5315d0"
                       title="Choose step color">
                <br>
                
                <!-- Submit Button (disabled by default) -->
                <button type="submit" 
                        class="btn-primary" 
                        id="createStepBtn" 
                        disabled>
                    Insert Step
                </button>
            </form>
        </div>
        
        <!-- 
        ====================================================================
        STEP DEFINITIONS TABLE HEADER
        ====================================================================
        Fixed header for the steps table with column definitions.
        ====================================================================
        -->
        <div class="fixed-header">
            <table class="header-table">
                <tr class="tab-header-settings">
                    <th>Id</th>
                    <th>Step Name</th>
                    <th>Step Description</th>
                    <th>Step Color</th>
                    <th></th> <!-- Edit column -->
                    <th></th> <!-- Delete column -->
                </tr>
            </table>
        </div>
        
        <!-- 
        ====================================================================
        STEP DEFINITIONS TABLE BODY
        ====================================================================
        Scrollable table containing all step definitions with actions.
        System steps (ID 1, 6, 7) have disabled edit/delete buttons.
        ====================================================================
        -->
        <div class="glass-container-tab-settings">
            <table class="tab-platforms">
                {% for step in steps %}
                <tr class="tab-body-settings">
                    <!-- Step ID -->
                    <td>{{ step.id }}</td>
                    
                    <!-- Step Name -->
                    <td>{{ step.name }}</td>
                    
                    <!-- Step Description -->
                    <td>{{ step.description }}</td>
                    
                    <!-- Step Color (displayed in actual color) -->
                    <td style="color: {{ step.color }};">{{ step.color }}</td>
                    
                    <!-- 
                    ========================================================
                    EDIT STEP BUTTON
                    ========================================================
                    Edit button with conditional disabling for system steps.
                    System steps (1=Applied, 6=Offer, 7=Denied) are protected.
                    ========================================================
                    -->
                    <td>
                        <i class="fa-solid fa-pen-to-square edit-btn {% if step.id in [1, 6, 7] %}disabled{% endif %}" 
                           style="color: #13ecab; cursor: pointer;" 
                           data-step-id="{{ step.id }}"
                           data-step-name="{{ step.name }}"
                           data-step-description="{{ step.description }}"
                           data-step-color="{{ step.color }}"
                           title="{% if step.id in [1, 6, 7] %}System step - cannot edit{% else %}Edit Step{% endif %}">
                        </i>
                    </td>
                    
                    <!-- 
                    ========================================================
                    DELETE STEP BUTTON
                    ========================================================
                    Delete button with conditional disabling for system steps.
                    Protected steps cannot be deleted to maintain system integrity.
                    ========================================================
                    -->
                    <td>
                        <i class="fa-solid fa-trash delete-btn {% if step.id in [1, 6, 7] %}disabled{% endif %}" 
                           style="color: #5315d0; cursor: pointer;" 
                           data-step-id="{{ step.id }}"
                           data-step-name="{{ step.name }}"
                           data-step-description="{{ step.description }}"
                           data-step-color="{{ step.color }}"
                           title="{% if step.id in [1, 6, 7] %}System step - cannot delete{% else %}Delete Step{% endif %}">
                        </i>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    
    <!-- 
    ========================================================================
    FEEDBACK DEFINITIONS MANAGEMENT SECTION
    ========================================================================
    This section manages feedback types that classify application outcomes
    and current status (Pending, Offer, Rejection, etc.).
    ========================================================================
    -->
    <div class="item-setting">
        <!-- Section Header -->
        <h3 class="box_title">Feedbacks Settings</h3>
        
        <!-- 
        ====================================================================
        CREATE FEEDBACK DEFINITION FORM
        ====================================================================
        Form for adding new feedback definitions with validation.
        Similar structure to step definitions but for feedback types.
        ====================================================================
        -->
        <div class="glass-container-settings">
            <form method="post" class="form_steps_definition">
                <!-- Hidden field to identify form type in backend -->
                <input type="hidden" name="form_type" value="create_feedback_defition">
                
                <!-- Feedback Name Input -->
                <input type="text" 
                       id="feedback_name" 
                       name="feedback_name" 
                       placeholder="Feedback Name" 
                       class="form-input-settings"
                       required>
                <br>
                
                <!-- Feedback Description Input -->
                <input type="text" 
                       id="feedback_description" 
                       name="feedback_description" 
                       placeholder="Feedback Description" 
                       class="form-input-settings"
                       required>
                <br>
                
                <!-- Feedback Color Picker -->
                <input type="color" 
                       id="feedback_color" 
                       name="feedback_color" 
                       class="form-color-settings" 
                       value="#5315d0"
                       title="Choose feedback color">
                <br>
                
                <!-- Submit Button (disabled by default) -->
                <button type="submit" 
                        class="btn-primary" 
                        id="createFeedBtn" 
                        disabled>
                    Insert Feedback
                </button>
            </form>
        </div>
        
        <!-- 
        ====================================================================
        FEEDBACK DEFINITIONS TABLE HEADER
        ====================================================================
        Fixed header for the feedback table with column definitions.
        ====================================================================
        -->
        <div class="fixed-header">
            <table class="header-table">
                <tr class="tab-header-settings">
                    <th>Id</th>
                    <th>Feedback Name</th>
                    <th>Feedback Description</th>
                    <th>Feedback Color</th>
                    <th></th> <!-- Edit column -->
                    <th></th> <!-- Delete column -->
                </tr>
            </table>
        </div>
        
        <!-- 
        ====================================================================
        FEEDBACK DEFINITIONS TABLE BODY
        ====================================================================
        Scrollable table containing all feedback definitions with actions.
        Default feedback (ID 1) is protected from modification.
        ====================================================================
        -->
        <div class="glass-container-tab-settings">
            <table class="tab-platforms">
                {% for feedback in feedbacks %}
                <tr class="tab-body-settings">
                    <!-- Feedback ID -->
                    <td>{{ feedback.id }}</td>
                    
                    <!-- Feedback Name -->
                    <td>{{ feedback.name }}</td>
                    
                    <!-- Feedback Description -->
                    <td>{{ feedback.description }}</td>
                    
                    <!-- Feedback Color (displayed in actual color) -->
                    <td style="color: {{ feedback.color }};">{{ feedback.color }}</td>
                    
                    <!-- 
                    ========================================================
                    EDIT FEEDBACK BUTTON
                    ========================================================
                    Edit button with conditional disabling for default feedback.
                    Default feedback (ID 1) is protected from modification.
                    ========================================================
                    -->
                    <td>
                        <i class="fa-solid fa-pen-to-square edit-btnF {% if feedback.id == 1 %}disabled{% endif %}" 
                           style="color: #13ecab; cursor: pointer;" 
                           data-feedback-id="{{ feedback.id }}"
                           data-feedback-name="{{ feedback.name }}"
                           data-feedback-description="{{ feedback.description }}"
                           data-feedback-color="{{ feedback.color }}"
                           title="{% if feedback.id == 1 %}Default feedback - cannot edit{% else %}Edit Feedback{% endif %}">
                        </i>
                    </td>
                    
                    <!-- 
                    ========================================================
                    DELETE FEEDBACK BUTTON
                    ========================================================
                    Delete button with conditional disabling for default feedback.
                    Default feedback cannot be deleted to maintain system integrity.
                    ========================================================
                    -->
                    <td>
                        <i class="fa-solid fa-trash delete-btnF {% if feedback.id == 1 %}disabled{% endif %}" 
                           style="color: #5315d0; cursor: pointer;" 
                           data-feedback-id="{{ feedback.id }}"
                           data-feedback-name="{{ feedback.name }}"
                           data-feedback-description="{{ feedback.description }}"
                           data-feedback-color="{{ feedback.color }}"
                           title="{% if feedback.id == 1 %}Default feedback - cannot delete{% else %}Delete Feedback{% endif %}">
                        </i>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>

<!--
================================================================================
MODAL INTERFACES
================================================================================
Modal dialogs for step and feedback management operations.
Each type has separate modals for edit and delete operations.
================================================================================
-->

<!-- 
====================================================================
EDIT STEP DEFINITION MODAL
====================================================================
Modal for editing existing step definitions with pre-populated form.
====================================================================
-->
<div id="editModalStep" class="modal">
    <div class="modal-content glass-container">
        <div class="modal-header">
            <h3>Edit Step Definition</h3>
            <span class="close" title="Close Modal">&times;</span>
        </div>
        
        <form id="editFormStep" method="post" class="form_platforms">
            <!-- Step Name Input (pre-populated) -->
            <input type="text" 
                   id="edit_step_name" 
                   name="step_name" 
                   placeholder="Step Name" 
                   class="form-input-settings" 
                   required>
            
            <!-- Step Description Input (pre-populated) -->
            <input type="text" 
                   id="edit_step_description" 
                   name="step_description" 
                   placeholder="Step Description" 
                   class="form-input-settings" 
                   required>
            
            <!-- Step Color Picker (pre-populated) -->
            <input type="color" 
                   id="edit_step_color" 
                   name="step_color" 
                   class="form-color-settings">
            
            <!-- Update Button -->
            <button type="submit" class="btn-primary">Update Step</button>
        </form>
    </div>
</div>

<!-- 
====================================================================
EDIT FEEDBACK DEFINITION MODAL
====================================================================
Modal for editing existing feedback definitions with pre-populated form.
====================================================================
-->
<div id="editModalFeed" class="modal">
    <div class="modal-content glass-container">
        <div class="modal-header">
            <h3>Edit Feedback Definition</h3>
            <span class="closeF" title="Close Modal">&times;</span>
        </div>
        
        <form id="editFormFeed" method="post" class="form_platforms">
            <!-- Feedback Name Input (pre-populated) -->
            <input type="text" 
                   id="edit_feedback_name" 
                   name="feedback_name" 
                   placeholder="Feedback Name" 
                   class="form-input-settings" 
                   required>
            
            <!-- Feedback Description Input (pre-populated) -->
            <input type="text" 
                   id="edit_feedback_description" 
                   name="feedback_description" 
                   placeholder="Feedback Description" 
                   class="form-input-settings" 
                   required>
            
            <!-- Feedback Color Picker (pre-populated) -->
            <input type="color" 
                   id="edit_feedback_color" 
                   name="feedback_color" 
                   class="form-color-settings">
            
            <!-- Update Button -->
            <button type="submit" class="btn-primary">Update Feedback</button>
        </form>
    </div>
</div>

<!-- 
====================================================================
DELETE STEP DEFINITION MODAL
====================================================================
Confirmation modal for step deletion with application warning.
Shows count of applications that will be affected by deletion.
====================================================================
-->
<div id="deleteModalStep" class="modal">
    <div class="modal-content glass-container">
        <div class="modal-header">
            <h3>Delete Step Definition</h3>
            <span class="close-delete" title="Close Modal">&times;</span>
        </div>
        
        <div class="modal-body">
            <!-- Confirmation Message -->
            <p id="deleteMessage">Are you sure you want to delete this step?</p>
            
            <!-- 
            ================================================================
            APPLICATIONS WARNING FOR STEPS
            ================================================================
            Warning message showing how many applications use this step.
            Displayed when applications would be affected by deletion.
            ================================================================
            -->
            <div id="applicationsWarning" class="warning-message" style="display: none;">
                <strong>Warning:</strong> This will also delete 
                <span id="applicationCount"></span> application(s) linked to this step definition.
            </div>
        </div>
        
        <div class="modal-footer">
            <!-- Cancel Button -->
            <button type="button" class="btn-secondary" id="cancelDelete">Cancel</button>
            
            <!-- Delete Confirmation Form -->
            <form id="deleteFormStep" method="post" style="display: inline;">
                <button type="submit" class="btn-danger">Delete</button>
            </form>
        </div>
    </div>
</div>

<!-- 
====================================================================
DELETE FEEDBACK DEFINITION MODAL
====================================================================
Confirmation modal for feedback deletion with application warning.
Shows count of applications that will be affected by deletion.
====================================================================
-->
<div id="deleteModalFeed" class="modal">
    <div class="modal-content glass-container">
        <div class="modal-header">
            <h3>Delete Feedback Definition</h3>
            <span class="close-deleteF" title="Close Modal">&times;</span>
        </div>
        
        <div class="modal-body">
            <!-- Confirmation Message -->
            <p id="deleteMessageF">Are you sure you want to delete this feedback?</p>
            
            <!-- 
            ================================================================
            APPLICATIONS WARNING FOR FEEDBACK
            ================================================================
            Warning message showing how many applications use this feedback.
            Displayed when applications would be affected by deletion.
            ================================================================
            -->
            <div id="applicationsWarningF" class="warning-message" style="display: none;">
                <strong>Warning:</strong> This will also delete 
                <span id="applicationCountF"></span> application(s) linked to this feedback definition.
            </div>
        </div>
        
        <div class="modal-footer">
            <!-- Cancel Button -->
            <button type="button" class="btn-secondary" id="cancelDeleteF">Cancel</button>
            
            <!-- Delete Confirmation Form -->
            <form id="deleteFormFeed" method="post" style="display: inline;">
                <button type="submit" class="btn-danger">Delete</button>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!--
================================================================================
JAVASCRIPT FUNCTIONALITY
================================================================================
Comprehensive JavaScript functionality for settings management including:
- Modal management for both steps and feedback
- Form validation for create forms
- Application count checking before deletion
- Protected item handling (disabled buttons)
- Dynamic UI updates and user feedback
================================================================================
-->

<script>
/**
 * EDIT STEP DEFINITION FUNCTIONALITY
 * ==================================
 * Handles the edit step modal, form population, and submission.
 * Opens modal with pre-populated data when edit button is clicked.
 */
document.addEventListener('DOMContentLoaded', function() {
    // Get DOM elements for step editing
    const modal = document.getElementById('editModalStep');
    const editForm = document.getElementById('editFormStep');
    const closeBtn = document.querySelector('.close');
    const editButtons = document.querySelectorAll('.edit-btn');

    /**
     * Edit Step Button Click Handler
     * Opens edit modal and populates form with current step data
     */
    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Skip if button is disabled (system steps)
            if (this.classList.contains('disabled')) {
                return;
            }
            
            // Extract step data from button data attributes
            const stepId = this.dataset.stepId;
            const stepName = this.dataset.stepName;
            const stepDescription = this.dataset.stepDescription;
            const stepColor = this.dataset.stepColor;
            
            // Set form action URL for update operation
            editForm.action = `/settings/steps/${stepId}/update`;

            // Populate form fields with current step data
            document.getElementById('edit_step_name').value = stepName;
            document.getElementById('edit_step_description').value = stepDescription;
            document.getElementById('edit_step_color').value = stepColor;
            
            // Show modal with populated data
            modal.classList.add('show');
        });
    });

    /**
     * Modal Close Event Handlers
     * Handle closing the modal via close button or outside click
     */
    
    // Close modal when X button is clicked
    closeBtn.addEventListener('click', function() {
        modal.classList.remove('show');
    });

    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.classList.remove('show');
        }
    });
});
</script>

<script>
/**
 * EDIT FEEDBACK DEFINITION FUNCTIONALITY
 * ======================================
 * Handles the edit feedback modal, form population, and submission.
 * Similar to step editing but for feedback definitions.
 */
document.addEventListener('DOMContentLoaded', function() {
    // Get DOM elements for feedback editing
    const modalF = document.getElementById('editModalFeed');
    const editFormF = document.getElementById('editFormFeed');
    const closeBtnF = document.querySelector('.closeF');
    const editButtonsF = document.querySelectorAll('.edit-btnF');

    /**
     * Edit Feedback Button Click Handler
     * Opens edit modal and populates form with current feedback data
     */
    editButtonsF.forEach(button => {
        button.addEventListener('click', function() {
            // Skip if button is disabled (default feedback)
            if (this.classList.contains('disabled')) {
                return;
            }
            
            // Extract feedback data from button data attributes
            const feedbackId = this.dataset.feedbackId;
            const feedbackName = this.dataset.feedbackName;
            const feedbackDescription = this.dataset.feedbackDescription;
            const feedbackColor = this.dataset.feedbackColor;
            
            // Set form action URL for update operation
            editFormF.action = `/settings/feedbacks/${feedbackId}/update`;

            // Populate form fields with current feedback data
            document.getElementById('edit_feedback_name').value = feedbackName;
            document.getElementById('edit_feedback_description').value = feedbackDescription;
            document.getElementById('edit_feedback_color').value = feedbackColor;
            
            // Show modal with populated data
            modalF.classList.add('show');
        });
    });

    /**
     * Modal Close Event Handlers
     * Handle closing the feedback modal via close button or outside click
     */
    
    // Close modal when X button is clicked
    closeBtnF.addEventListener('click', function() {
        modalF.classList.remove('show');
    });

    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
        if (event.target === modalF) {
            modalF.classList.remove('show');
        }
    });
});
</script>

<script>
/**
 * DELETE STEP DEFINITION FUNCTIONALITY
 * ====================================
 * Handles step deletion with application count checking and warning.
 * Provides confirmation dialog with details about linked applications.
 */

// Get DOM elements for step deletion
const deleteModal = document.getElementById('deleteModalStep');
const deleteForm = document.getElementById('deleteFormStep');
const closeDeleteBtn = document.querySelector('.close-delete');
const cancelDeleteBtn = document.getElementById('cancelDelete');
const deleteButtons = document.querySelectorAll('.delete-btn');
const applicationsWarning = document.getElementById('applicationsWarning');
const applicationCount = document.getElementById('applicationCount');

/**
 * Delete Step Button Click Handler
 * Opens delete confirmation modal and checks for linked applications
 */
deleteButtons.forEach(button => {
    button.addEventListener('click', function() {
        // Skip if button is disabled (system steps)
        if (this.classList.contains('disabled')) {
            return;
        }
        
        // Extract step data from button data attributes
        const stepId = this.dataset.stepId;
        const stepName = this.dataset.stepName;

        // Set form action URL for delete operation
        deleteForm.action = `/settings/steps/${stepId}/delete`;

        // Update confirmation message with specific step name
        document.getElementById('deleteMessage').textContent = 
            `Are you sure you want to delete "${stepName}"?`;

        /**
         * Check for Linked Applications
         * Makes an AJAX request to check how many applications
         * use this step before deletion
         */
        fetch(`/settings/steps/${stepId}/check_applications`)
            .then(response => response.json())
            .then(data => {
                if (data.count > 0) {
                    // Show warning if applications use this step
                    applicationCount.textContent = data.count;
                    applicationsWarning.style.display = 'block';
                } else {
                    // Hide warning if no applications use this step
                    applicationsWarning.style.display = 'none';
                }
            })
            .catch(error => {
                // Handle potential errors in application count check
                console.error('Error checking applications:', error);
                applicationsWarning.style.display = 'none';
            });

        // Show delete confirmation modal
        deleteModal.classList.add('show');
    });
});

/**
 * Delete Modal Close Event Handlers
 * Handle closing the delete modal via various methods
 */

// Close modal when X button is clicked
closeDeleteBtn.addEventListener('click', function() {
    deleteModal.classList.remove('show');
});

// Close modal when Cancel button is clicked
cancelDeleteBtn.addEventListener('click', function() {
    deleteModal.classList.remove('show');
});

// Close modal when clicking outside the modal content
window.addEventListener('click', function(event) {
    if (event.target === deleteModal) {
        deleteModal.classList.remove('show');
    }
});
</script>

<script>
/**
 * DELETE FEEDBACK DEFINITION FUNCTIONALITY
 * ========================================
 * Handles feedback deletion with application count checking and warning.
 * Similar to step deletion but for feedback definitions.
 */

// Get DOM elements for feedback deletion
const deleteModalF = document.getElementById('deleteModalFeed');
const deleteFormF = document.getElementById('deleteFormFeed');
const closeDeleteBtnF = document.querySelector('.close-deleteF');
const cancelDeleteBtnF = document.getElementById('cancelDeleteF');
const deleteButtonsF = document.querySelectorAll('.delete-btnF');
const applicationsWarningF = document.getElementById('applicationsWarningF');
const applicationCountF = document.getElementById('applicationCountF');

/**
 * Delete Feedback Button Click Handler
 * Opens delete confirmation modal and checks for linked applications
 */
deleteButtonsF.forEach(button => {
    button.addEventListener('click', function() {
        // Skip if button is disabled (default feedback)
        if (this.classList.contains('disabled')) {
            return;
        }
        
        // Extract feedback data from button data attributes
        const feedbackId = this.dataset.feedbackId;
        const feedbackName = this.dataset.feedbackName;

        // Set form action URL for delete operation
        deleteFormF.action = `/settings/feedbacks/${feedbackId}/delete`;

        // Update confirmation message with specific feedback name
        document.getElementById('deleteMessageF').textContent = 
            `Are you sure you want to delete "${feedbackName}"?`;

        /**
         * Check for Linked Applications
         * Makes an AJAX request to check how many applications
         * use this feedback before deletion
         */
        fetch(`/settings/feedbacks/${feedbackId}/check_applications`)
            .then(response => response.json())
            .then(data => {
                if (data.count > 0) {
                    // Show warning if applications use this feedback
                    applicationCountF.textContent = data.count;
                    applicationsWarningF.style.display = 'block';
                } else {
                    // Hide warning if no applications use this feedback
                    applicationsWarningF.style.display = 'none';
                }
            })
            .catch(error => {
                // Handle potential errors in application count check
                console.error('Error checking applications:', error);
                applicationsWarningF.style.display = 'none';
            });

        // Show delete confirmation modal
        deleteModalF.classList.add('show');
    });
});

/**
 * Delete Modal Close Event Handlers
 * Handle closing the feedback delete modal via various methods
 */

// Close modal when X button is clicked
closeDeleteBtnF.addEventListener('click', function() {
    deleteModalF.classList.remove('show');
});

// Close modal when Cancel button is clicked
cancelDeleteBtnF.addEventListener('click', function() {
    deleteModalF.classList.remove('show');
});

// Close modal when clicking outside the modal content
window.addEventListener('click', function(event) {
    if (event.target === deleteModalF) {
        deleteModalF.classList.remove('show');
    }
});
</script>

<script>
/**
 * CREATE STEP DEFINITION FORM VALIDATION
 * ======================================
 * Provides real-time form validation for the create step form.
 * Enables the submit button only when required fields are filled.
 */

// Get step form elements
const stepNameInput = document.getElementById('step_name');
const stepDescriptionInput = document.getElementById('step_description');
const createStepBtn = document.getElementById('createStepBtn');

/**
 * Step Form Validation Function
 * Checks if both name and description fields have content and
 * enables/disables the submit button accordingly
 */
function validateStepCreateForm() {
    // Get trimmed values from both inputs
    const nameValue = stepNameInput.value.trim();
    const descriptionValue = stepDescriptionInput.value.trim();

    // Enable submit button only if both fields have content
    if (nameValue.length > 0 && descriptionValue.length > 0) {
        createStepBtn.disabled = false;
        createStepBtn.style.opacity = '1';
        createStepBtn.style.cursor = 'pointer';
    } else {
        createStepBtn.disabled = true;
        createStepBtn.style.opacity = '0.6';
        createStepBtn.style.cursor = 'not-allowed';
    }
}

/**
 * Event Listeners for Real-time Step Validation
 * Attach input event listeners to step form fields for immediate feedback
 */
stepNameInput.addEventListener('input', validateStepCreateForm);
stepDescriptionInput.addEventListener('input', validateStepCreateForm);

// Initial validation check when page loads
validateStepCreateForm();
</script>

<script>
/**
 * CREATE FEEDBACK DEFINITION FORM VALIDATION
 * ==========================================
 * Provides real-time form validation for the create feedback form.
 * Enables the submit button only when required fields are filled.
 */

// Get feedback form elements
const feedbackNameInput = document.getElementById('feedback_name');
const feedbackDescriptionInput = document.getElementById('feedback_description');
const createFeedBtn = document.getElementById('createFeedBtn');

/**
 * Feedback Form Validation Function
 * Checks if both name and description fields have content and
 * enables/disables the submit button accordingly
 */
function validateFeedbackCreateForm() {
    // Get trimmed values from both inputs
    const nameValue = feedbackNameInput.value.trim();
    const descriptionValue = feedbackDescriptionInput.value.trim();

    // Enable submit button only if both fields have content
    if (nameValue.length > 0 && descriptionValue.length > 0) {
        createFeedBtn.disabled = false;
        createFeedBtn.style.opacity = '1';
        createFeedBtn.style.cursor = 'pointer';
    } else {
        createFeedBtn.disabled = true;
        createFeedBtn.style.opacity = '0.6';
        createFeedBtn.style.cursor = 'not-allowed';
    }
}

/**
 * Event Listeners for Real-time Feedback Validation
 * Attach input event listeners to feedback form fields for immediate feedback
 */
feedbackNameInput.addEventListener('input', validateFeedbackCreateForm);
feedbackDescriptionInput.addEventListener('input', validateFeedbackCreateForm);

// Initial validation check when page loads
validateFeedbackCreateForm();

/**
 * Additional Form Enhancement Functions
 * ====================================
 * Additional functionality to improve user experience with forms
 */

/**
 * Form Submission Enhancement
 * Add loading states to submit buttons during form submission
 */
document.querySelector('.form_steps_definition').addEventListener('submit', function(e) {
    // Check which form is being submitted by looking at the hidden form_type field
    const formType = this.querySelector('input[name="form_type"]').value;
    
    if (formType === 'create_step_defition') {
        createStepBtn.textContent = 'Adding Step...';
        createStepBtn.disabled = true;
    } else if (formType === 'create_feedback_defition') {
        createFeedBtn.textContent = 'Adding Feedback...';
        createFeedBtn.disabled = true;
    }
});

/**
 * Keyboard Enhancement for Better UX
 * Handle Enter key press in form fields for quick submission
 */

// Step form keyboard events
stepNameInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !createStepBtn.disabled) {
        createStepBtn.click();
    }
});

stepDescriptionInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !createStepBtn.disabled) {
        createStepBtn.click();
    }
});

// Feedback form keyboard events
feedbackNameInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !createFeedBtn.disabled) {
        createFeedBtn.click();
    }
});

feedbackDescriptionInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !createFeedBtn.disabled) {
        createFeedBtn.click();
    }
});

/**
 * Color Picker Enhancement
 * Add visual feedback when color is changed
 */
document.getElementById('step_color').addEventListener('change', function() {
    // Add a subtle visual effect when color is changed
    this.style.transform = 'scale(1.05)';
    setTimeout(() => {
        this.style.transform = 'scale(1)';
    }, 150);
});

document.getElementById('feedback_color').addEventListener('change', function() {
    // Add a subtle visual effect when color is changed
    this.style.transform = 'scale(1.05)';
    setTimeout(() => {
        this.style.transform = 'scale(1)';
    }, 150);
});

/**
 * Protected Items Visual Feedback
 * Add tooltip and visual feedback for disabled buttons
 */
document.addEventListener('DOMContentLoaded', function() {
    // Add visual feedback for disabled buttons
    const disabledButtons = document.querySelectorAll('.disabled');
    
    disabledButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Add a shake animation to indicate the button is disabled
            this.style.animation = 'shake 0.5s ease-in-out';
            
            // Remove animation after it completes
            setTimeout(() => {
                this.style.animation = '';
            }, 500);
        });
    });
});

/**
 * Dynamic Table Row Highlighting
 * Add hover effects and visual feedback for table interactions
 */
document.addEventListener('DOMContentLoaded', function() {
    const tableRows = document.querySelectorAll('.tab-body-settings');
    
    tableRows.forEach(row => {
        // Add hover effect for better UX
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
            this.style.transform = 'scale(1.02)';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
            this.style.transform = 'scale(1)';
        });
    });
});
</script>
{% endblock %}